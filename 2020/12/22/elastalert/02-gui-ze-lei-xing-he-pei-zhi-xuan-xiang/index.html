<!DOCTYPE HTML>
<html lang="zh-CN">


<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="utf-8">
    <meta name="keywords" content="02_规则类型和配置选项, 技术博客 钟鸿鹏 honphan 阿钟">
    <meta name="baidu-site-verification" content="fmlEuI34ir">
    <meta name="google-site-verification" content="yCy2azpds5XSuGZvis6OuA-XIGF5GuGpYRAaGfD6o48">
    <meta name="360-site-verification" content="b7c11a830ef90fd1464ad6206bb7b6e7">
    <meta name="description" content="在源码目录下的 example_rules 文件夹中有几个不同类型的 规则 配置可以参考。

注意：
所有的时间选项的格式都是 &amp;lt;单位&amp;gt;:X , 其中单位可以是 weeks, days, hours, minutes 或者 se">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>02_规则类型和配置选项 | 阿钟的博客</title>
    <link rel="icon" type="image/png" href="/favicon.png">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">
    <style type="text/css">
        
    </style>

    <script src="/libs/jquery/jquery-2.2.0.min.js"></script>
    <script src="https://sdk.jinrishici.com/v2/browser/jinrishici.js" charset="utf-8"></script>
    <script>
        var _hmt = _hmt || [];
        (function () {
            var hm = document.createElement("script");
            hm.src = "https://hm.baidu.com/hm.js?46e79e71af0709a5b9106bf20cecc493";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();
    </script>

    
        <script>
            (function(){
                var bp = document.createElement('script');
                var curProtocol = window.location.protocol.split(':')[0];
                if (curProtocol === 'https') {
                    bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
                }
                else {
                    bp.src = 'http://push.zhanzhang.baidu.com/push.js';
                }
                var s = document.getElementsByTagName("script")[0];
                s.parentNode.insertBefore(bp, s);
            })();
        </script>
    

    <script>
        (function(){
        var src = "https://jspassport.ssl.qhimg.com/11.0.1.js?d182b3f28525f2db83acfaaf6e696dba";
        document.write('<script src="' + src + '" id="sozz"><\/script>');
        })();
    </script>

<link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head>

<body>

    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">阿钟的博客</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fa fa-navicon"></i></a>
<ul class="right">
    
    <li class="hide-on-med-and-down">
        <a href="/" class="waves-effect waves-light">
            
            <i class="fa fa-home"></i>
            
            <span>首页</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/tags" class="waves-effect waves-light">
            
            <i class="fa fa-tags"></i>
            
            <span>标签</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/categories" class="waves-effect waves-light">
            
            <i class="fa fa-bookmark"></i>
            
            <span>分类</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/archives" class="waves-effect waves-light">
            
            <i class="fa fa-archive"></i>
            
            <span>归档</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/about" class="waves-effect waves-light">
            
            <i class="fa fa-user-circle-o"></i>
            
            <span>关于</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/friends" class="waves-effect waves-light">
            
            <i class="fa fa-address-book"></i>
            
            <span>友情链接</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/contact" class="waves-effect waves-light">
            
            <i class="fa fa-comments"></i>
            
            <span>留言板</span>
        </a>
    </li>
    
    <li>
        <a href="#searchModal" class="modal-trigger waves-effect waves-light">
            <i id="searchIcon" class="fa fa-search" title="搜索"></i>
        </a>
    </li>
</ul>

<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">阿钟的博客</div>
        <div class="logo-desc">
            
            keep going...
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li>
            <a href="/" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-home"></i>
                
                首页
            </a>
        </li>
        
        <li>
            <a href="/tags" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-tags"></i>
                
                标签
            </a>
        </li>
        
        <li>
            <a href="/categories" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-bookmark"></i>
                
                分类
            </a>
        </li>
        
        <li>
            <a href="/archives" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-archive"></i>
                
                归档
            </a>
        </li>
        
        <li>
            <a href="/about" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-user-circle-o"></i>
                
                关于
            </a>
        </li>
        
        <li>
            <a href="/friends" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-address-book"></i>
                
                友情链接
            </a>
        </li>
        
        <li>
            <a href="/contact" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-comments"></i>
                
                留言板
            </a>
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/JohnZhongg" class="waves-effect waves-light" target="_blank">
                <i class="fa fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>

        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/JohnZhongg" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    
<script src="/libs/cryptojs/crypto-js.min.js"></script>
<script>
    (function() {
        let pwd = '';
        if (pwd && pwd.length > 0) {
            if (pwd !== CryptoJS.SHA256(prompt('请输入访问本文章的密码')).toString(CryptoJS.enc.Hex)) {
                alert('密码错误，将返回主页！');
                location.href = '/';
            }
        }
    })();
</script>




<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/1.jpg')">
    <div class="container">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <div class="description center-align post-title">
                        02_规则类型和配置选项
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>



<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        margin: 35px 0 15px 0;
        padding-left: 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #toc-content .is-active-link::before {
        background-color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 20px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                        <a href="/tags/ES学习/" target="_blank">
                            <span class="chip bg-color">ES学习</span>
                        </a>
                        
                        <a href="/tags/ELK告警/" target="_blank">
                            <span class="chip bg-color">ELK告警</span>
                        </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fa fa-bookmark fa-fw icon-category"></i>
                        
                        <a href="/categories/elastalert/" class="post-category" target="_blank">
                            elastalert
                        </a>
                        
                        <a href="/categories/elastalert/ES学习/" class="post-category" target="_blank">
                            ES学习
                        </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                <div class="post-date info-break-policy">
                    <i class="fa fa-calendar-minus-o fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2020-12-22
                </div>

                <div class="post-author info-break-policy">
                    <i class="fa fa-user-o fa-fw"></i>作者:&nbsp;&nbsp;
                    
                    阿钟
                    
                </div>

                
                
                <div class="info-break-policy">
                    <i class="fa fa-file-word-o fa-fw"></i>文章字数:&nbsp;&nbsp;
                    3.3k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="fa fa-clock-o fa-fw"></i>阅读时长:&nbsp;&nbsp;
                    13 分
                </div>
                
                

                
                <div id="busuanzi_container_page_pv" class="info-break-policy">
                    <i class="fa fa-eye fa-fw"></i>阅读次数:&nbsp;&nbsp;
                    <span id="busuanzi_value_page_pv"></span>
                </div>
                
            </div>
        </div>
        <hr class="clearfix">
        <div class="card-content article-card-content">
            <div id="articleContent">
                <p>在源码目录下的 <code>example_rules</code> 文件夹中有几个不同类型的 <code>规则</code> 配置可以参考。</p>
<blockquote>
<p>注意：</p>
<p>所有的时间选项的格式都是 <code>&lt;单位&gt;:X</code> , 其中单位可以是 weeks, days, hours, minutes 或者 seconds. 例如 <code>minutes: 15</code> 或者 <code>hours: 1</code> .</p>
</blockquote>
<h2 id="规则配置列表"><a class="header-anchor" href="#规则配置列表">¶</a>规则配置列表</h2>
<h3 id="所有规则通用"><a class="header-anchor" href="#所有规则通用">¶</a>所有规则通用</h3>
<h4 id="必须"><a class="header-anchor" href="#必须">¶</a>必须</h4>
<h5 id="es-host-string-no-default"><a class="header-anchor" href="#es-host-string-no-default">¶</a><code>es_host</code>(string, no default)</h5>
<p><code>规则</code> 要轮询(监控)的 ES 集群 hostname</p>
<h5 id="es-port-number-no-default"><a class="header-anchor" href="#es-port-number-no-default">¶</a><code>es_port</code> (number, no default)</h5>
<p>ES 集群端口</p>
<h5 id="index-string-no-default"><a class="header-anchor" href="#index-string-no-default">¶</a><code>index</code> (string, no default)</h5>
<p>要查询的索引. 可以使用通配符, 例如: <code>index: my-index-*</code>. 还可以使用包含 <code>%Y</code>表示年、<code>%m</code>表示月、<code>%d</code>表示天的格式化字符串. 如果要使用这种格式化字符串, 需要将 <code>use_strftime_index</code> 设置为 true</p>
<h5 id="type-string-no-default"><a class="header-anchor" href="#type-string-no-default">¶</a><code>type</code> (string, no default)</h5>
<p>要使用的<code>规则类型</code>：<code>RuleType</code>（包含内置和自定义并导入的）. 对于导入模块的类型应该被声明为 <code>module.file.RuleName</code>.</p>
<h5 id="alert-string-or-list-no-defult"><a class="header-anchor" href="#alert-string-or-list-no-defult">¶</a><code>alert</code> (string or list, no defult)</h5>
<p>要使用的<code>告警器</code>：<code>Alerter</code>.同 <code>规则类型</code> 包含内置和自定义导入的. 导入的<code>告警器</code>应该被声明为 <code>module.file.AlertName</code>.</p>
<h5 id="filter-ES-filter-DSL-no-default"><a class="header-anchor" href="#filter-ES-filter-DSL-no-default">¶</a><code>filter</code> (ES filter DSL, no default)</h5>
<p>一个 ES 查询 DSL 的 filters 列表. ElastAlert 将会使用 <code>{'filter': {'bool': {'must': [config.filter]}}}</code> 的格式（and 操作）以及一个额外的 timestamp range filter 来查询 ES. 这些 filters 的查询出来的所有结果都会被传递到 <code>RuleType</code> 进行分析. 对于更多关于如何书写 filters, 后续有介绍, 或者参考<a href="https://elastalert.readthedocs.io/en/latest/recipes/writing_filters.html#writingfilters" target="_blank" rel="noopener">官网</a>.</p>
<h4 id="非必须"><a class="header-anchor" href="#非必须">¶</a>非必须</h4>
<h5 id="buffer-time-time-default-from-config-yaml"><a class="header-anchor" href="#buffer-time-time-default-from-config-yaml">¶</a><code>buffer_time</code> (time, default from config.yaml)</h5>
<p>在当前 <code>规则</code> 中覆盖全局 <code>config.yaml</code> 的值. 如果 <code>use_count_qeury</code>或者<code>use_terms_query</code> 为true, 该值会被忽略.</p>
<h5 id="realert-time-default-1-min"><a class="header-anchor" href="#realert-time-default-1-min">¶</a><code>realert</code> (time, default: 1 min)</h5>
<p>这个选项允许你在一段时间内忽略重复告警. 如果<code>规则</code>设置了<code>query_key</code>字段, 这个选项将会基于每一个 key 起作用.</p>
<ul>
<li>对于给定 <code>规则</code> 的所有<code>匹配</code>、或者说在<code>query_key</code>上拥有同一个值的<code>匹配</code>将会在给定时间段被忽略.</li>
<li>所有 <code>query_key</code> 字段没有值的<code>匹配</code>都会被分到一个值设为<code>_missing</code> 的组.</li>
</ul>
<p>忽略时间是从一个<code>告警</code>发出的时间点开始算的, 而不是触发事件的时间.</p>
<p>默认值是 1 分钟, 这意味着 ElastAlert 如果运行了很长一段时间且触发了很多<code>规则</code>，只有第一个<code>告警</code>会被发出. 如果想每一条都发出, 需要设置 <code>realert</code> 为 0.</p>
<h5 id="exponential-realert-optional-time-no-default"><a class="header-anchor" href="#exponential-realert-optional-time-no-default">¶</a><code>exponential_realert</code> (optional, time, no default)</h5>
<p>使得 <code>alert</code> 成指数级增长直到 <code>exponential_realert</code> : 如果触发<code>匹配</code> 的时间距离上一次触发小于当前 <code>alert</code> 的两倍, 那么 <code>alert</code> 会翻倍.</p>
<h6 id="示例"><a class="header-anchor" href="#示例">¶</a>示例</h6>
<p>举个例子</p>
<ul>
<li><code>realert</code> 设置为 <code>minutes: 10</code>, <code>exponential_realert</code> 设置为 <code>hours: 1</code></li>
<li>一个<code>告警</code>在 1:00 的时候触发, 另一个在 1:15, 则下一个<code>告警</code>至少要是 1:35 之后才能触发.</li>
<li>如果在 1:35 到 2:15 之间触发了一个 <code>告警</code>, <code>realert</code> 将增长到 1 个小时（最大值）.</li>
<li>之后如果超过 2 个小时也没有触发 <code>告警</code>, <code>realert</code> 就会恢复.</li>
</ul>
<blockquote>
<p>注意那些被忽略的<code>告警</code>不会对<code>realert</code>产生影响（例如在 1:05 的时候）</p>
</blockquote>
<h5 id="name-string-defaults-to-the-filename"><a class="header-anchor" href="#name-string-defaults-to-the-filename">¶</a><code>name</code> (string, defaults to the filename)</h5>
<h5 id="use-strftime-index-boolean-default-False"><a class="header-anchor" href="#use-strftime-index-boolean-default-False">¶</a><code>use_strftime_index</code> (boolean, default False)</h5>
<p>如果设置为 true, ElastAlert 将会在每一次对于 ES 的查询中使用 <code>datetime.strftime</code> 来对索引进行格式化. 参考 <a href="https://docs.python.org/2/library/datetime.html#strftime-strptime-behavior" target="_blank" rel="noopener">strftime</a> 获取更多信息. 如果一个查询贯穿了好几天, 格式化之后的索引将会被用逗号拼接(其实就是使用 python 提供的字符串格式化 api 用一个格式匹配我们的想要的日期). 这对于缩小查询索引的范围是很有用的, 相对于通配符索引, 应该会有显著的提速.</p>
<h5 id="owner-string-default-empty-string"><a class="header-anchor" href="#owner-string-default-empty-string">¶</a><code>owner</code> (string, default empty string)</h5>
<p>这个值可以被用来标识<code>告警</code>的持有者. 可选的, 这个字段可以被包含在任何<code>告警</code>类型中</p>
<h5 id="priority-int-default-2"><a class="header-anchor" href="#priority-int-default-2">¶</a><code>priority</code> (int, default 2)</h5>
<p>该值被用来标识<code>告警</code>的相关优先级/重要程度. 可选的, 这个字段可以被包含在任意 <code>告警 </code>类型中（例如使用在 email 的主题或者正文文本中）.</p>
<p><code>category</code> (string, default empty string)</p>
<p>该值被用来标识<code>告警</code>的分组. 可选的, 这个字段可以被包含在任意 <code>告警 </code>类型中（例如使用在 email 的主题或者正文文本中）.</p>
<h5 id="query-delay-time-default-0-min"><a class="header-anchor" href="#query-delay-time-default-0-min">¶</a><code>query_delay</code> (time, default 0 min)</h5>
<p>这个选项将会使得 ElastAlert 减掉一个时间量, 让<code>规则</code>延迟运行. 这对于那些 ES 不是实时索引的数据是有用的.</p>
<h5 id="use-ssl-boolean-default-False"><a class="header-anchor" href="#use-ssl-boolean-default-False">¶</a><code>use_ssl</code> (boolean, default False)</h5>
<p>是否使用 TLS 连接 ES. 环境变量 <code>ES_USE_SSL</code> 会覆盖这个字段</p>
<h5 id="verify-certs-boolean-default-True"><a class="header-anchor" href="#verify-certs-boolean-default-True">¶</a><code>verify_certs</code> (boolean, default True)</h5>
<p>是否进行 TLS 证书验证 ES 连接</p>
<h5 id="client-cert-string-no-default"><a class="header-anchor" href="#client-cert-string-no-default">¶</a><code>client_cert</code>(string, no default)</h5>
<p>客户端 PEM 证书</p>
<h5 id="client-key-string-no-default"><a class="header-anchor" href="#client-key-string-no-default">¶</a><code>client_key</code>(string, no default)</h5>
<p>客户端私钥文件</p>
<h5 id="es-username-string-no-default"><a class="header-anchor" href="#es-username-string-no-default">¶</a><code>es_username</code> (string, no default)</h5>
<p>ES 登录用户名. 环境变量 <code>ES_USERNAME</code> 会覆盖这个字段</p>
<h5 id="es-password-string-no-default"><a class="header-anchor" href="#es-password-string-no-default">¶</a><code>es_password</code> (string, no default)</h5>
<p>ES 登录用户密码. 环境变量 <code>ES_PASSWORD</code> 会覆盖这个字段</p>
<h5 id="es-url-prefix-string-no-default"><a class="header-anchor" href="#es-url-prefix-string-no-default">¶</a><code>es_url_prefix</code> (string, no default)</h5>
<p>ES 端点的 URL 前缀</p>
<h5 id="es-send-get-body-as-string-default-“GET”"><a class="header-anchor" href="#es-send-get-body-as-string-default-“GET”">¶</a><code>es_send_get_body_as</code> (string, default “GET”)</h5>
<p>查询 ES 时使用的 HTTP 方法</p>
<h5 id="aggregation-time-no-default"><a class="header-anchor" href="#aggregation-time-no-default">¶</a><code>aggregation</code> (time, no default)</h5>
<p>这个选项允许你将多个<code>匹配</code>聚合到一个<code>告警</code>中. 每当一个<code>匹配</code>发生, ElastAlert就会等待一个 <code>aggregation</code> 的周期, 然后在周期时间到达后, 发送所有在该周期内出现的的 <code>匹配</code>  到<code>告警器</code>.</p>
<h6 id="示例-v2"><a class="header-anchor" href="#示例-v2">¶</a>示例</h6>
<pre class="line-numbers language-language-yaml"><code class="language-language-yaml">aggregation:
  hours: 2
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>12点整有一个告警, 13点整又有一个, 第三个是在14点半, 一个告警将会在14点发出, 因为12点整出现了第一个 <code>匹配</code>, 需要等待2个小时, 将这2个小时之内的所有<code>匹配</code>在14点整聚合成一个<code>告警</code>发出. 因为14点整之后的第一个<code>匹配</code>是在14点半, 所以又要等2个小时, 在16点半的时候将这两个小时内的所有<code>匹配</code>整合成一个<code>告警</code>发出.</p>
<h6 id="固定告警时间"><a class="header-anchor" href="#固定告警时间">¶</a>固定告警时间</h6>
<p>如果你希望在一个递推的时间间隔中聚合所有<code>告警</code>再发送, 你可以使用<code>schedule</code> 字段. 举个例子, 如果你希望在每个周一和周五接收<code>告警</code>:</p>
<pre class="line-numbers language-language-yaml"><code class="language-language-yaml">aggregation:
  schedule: '2 4 * * mon,fri'
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>这里使用了 <a href="http://www.nncron.ru/help/EN/working/cron-format.htm" target="_blank" rel="noopener">Cron</a> 语法. 注意不可以同时设置 <code>schedule</code> 和标准时间字段(<code>hours</code>、<code>minutes</code>、<code>days</code>), 只能选择其一.</p>
<h6 id="对匹配进行分组"><a class="header-anchor" href="#对匹配进行分组">¶</a>对<code>匹配</code>进行分组</h6>
<p>默认情况下, 所有在一个聚合窗口中的事件(<code>匹配</code>)会分在一组内. 不过, 如果你的规则定义了 <code>aggregation_key</code> 字段, 然后所有该字段拥有同一个值的事件都会被分为一组. 每当在该 key 上遇到一个新值的时候就会创建一个隔离的聚合窗口.</p>
<p>举个例子, 如果你希望接收以触发<code>匹配</code>事件的用户为分组的<code>告警</code>, 你可以这样设置:</p>
<pre class="line-numbers language-language-yaml"><code class="language-language-yaml">aggregation_key: 'my_data.username'
<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>假设有一个 10 分钟的聚合窗口, 如果接收到以下数据:</p>
<pre class="line-numbers language-language-json"><code class="language-language-json">{'my_data': {'username': 'alice', 'event_type': 'login'}, '@timestamp': '2016-09-20T00:00:00'}
{'my_data': {'username': 'bob', 'event_type': 'something'}, '@timestamp': '2016-09-20T00:05:00'}
{'my_data': {'username': 'alice', 'event_type': 'something else'}, '@timestamp': '2016-09-20T00:06:00'}
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>这将会生成 2 个<code>告警</code>: 一个包含 alice 的两个 <code>匹配</code> 事件, 在 <code>2016-09-20T00:10:00</code> 发送; 另一个包含 bob 的一个事件, 将会在 <code>2016-09-20T00:16:00</code> 发送.</p>
<h6 id="概要信息"><a class="header-anchor" href="#概要信息">¶</a>概要信息</h6>
<p>对于聚合告警来说, 有时候会在那些展示媒介（email, jira ticket等）上出现较大数量的文档(例如某个分组下出现了很多500错误). 如果你设置了 <code>summary_table_fields</code> 字段, ElastAlert 会从所有查询到的文档中针对该字段提供一个概要信息.</p>
<p>举个例子, 如果你希望对那些 <code>匹配</code> 了 <code>规则</code> 的文档的 <code>username</code> 和 <code>event_type</code> 做一个概述以便你可以很方便地得到最有相关/有价值的字段的信息, 你可以如下设置:</p>
<pre class="line-numbers language-language-yaml"><code class="language-language-yaml">summary_table_fields:
    - my_data.username
    - my_data.event_type
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>基于上面的 alice 和 bob 的数据, ElastAlert 会在告警媒介中提供如下概要表格:</p>
<pre class="line-numbers language-language-asciiarmor"><code class="language-language-asciiarmor">+------------------+--------------------+
| my_data.username | my_data.event_type |
+------------------+--------------------+
|      alice       |       login        |
|       bob        |     something      |
|      alice       |   something else   |
+------------------+--------------------+
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h6 id="注意"><a class="header-anchor" href="#注意">¶</a>注意</h6>
<p>默认的聚合时间是基于当前的系统时间, 而不是<code>匹配</code>的时间（例如第一条<code>匹配</code>出现后, 取当前系统时间戳作为时间窗口的起始值, 而不是取查询中的时间戳）. This means that running elastalert over past events will result in different alerts than if elastalert had been running while those events occured. This behavior can be changed by setting <code>aggregate_by_match_time</code>.</p>
<h5 id="aggregate-by-match-time"><a class="header-anchor" href="#aggregate-by-match-time">¶</a><code>aggregate_by_match_time</code></h5>
<p>Setting this to true will cause aggregations to be created relative to the timestamp of the first event, rather than the current time. This is useful for querying over historic data or if using a very large buffer_time and you want multiple aggregations to occur from a single query.</p>
<h5 id="max-query-size-int-default-global-max-query-size"><a class="header-anchor" href="#max-query-size-int-default-global-max-query-size">¶</a><code>max_query_size</code> (int, default global max_query_size)</h5>
<p>和全局 <code>max_query_size</code> 意义一样, 会覆盖全局的.</p>
<h5 id="include-list-of-string-default-“-”-all-fields"><a class="header-anchor" href="#include-list-of-string-default-“-”-all-fields">¶</a><code>include</code> (list of string, default [“*”] / all fields)</h5>
<p>查询结果应该返回的字段. 设置之后, 只有设置的字段以及 <a href="mailto:'%40timestamp" target="_blank" rel="noopener">‘@timestamp</a>’, <code>query_key</code>, <code>compare_key</code>, and <code>top_count_keys</code> 会返回.</p>
<h5 id="description-string-default-empty-string"><a class="header-anchor" href="#description-string-default-empty-string">¶</a><code>description</code> (string, default empty string)</h5>
<p>对于 <code>规则</code> 的描述. 可以在自定义<code>告警器</code>中引用到这个值, 提供一个 <code>规则</code> 触发原因的上下文.</p>
<h5 id="generate-kibana-link-boolean-default-False"><a class="header-anchor" href="#generate-kibana-link-boolean-default-False">¶</a><code>generate_kibana_link</code> (boolean, default False)</h5>
<p>这个选项只对 Kibana3 有效. 如果设置为 true, ElastAlert 将会在 <code>告警</code> 中生成一个临时的 Kibana 面板以及一个链接. 这个面板由一个基于时间变化的事件图标以及一个包含了 <code>include</code> 中字段的表格. 如果当前 <code>规则</code> 设置了 <code>query_key</code>, 这个面板也会包含一个关于该<code>告警</code>的该 <code>query_key</code> 的 filter. 该面板 schema 将会被上传到 kibana-int 的索引作为一个临时面板.</p>
<h5 id="kibana-url-string-default-from-http-es-host-es-port-plugin-kibana"><a class="header-anchor" href="#kibana-url-string-default-from-http-es-host-es-port-plugin-kibana">¶</a><code>kibana_url</code> (string, default from <code>http://&lt;es_host&gt;:&lt;es_port&gt;/_plugin/kibana/</code>)</h5>
<p>访问 Kibana 的 url. 这在 <code>generate_kibana_link</code> 或者 <code>use_kibana_dashboard</code> 为 true 的时候使用. 如果没有定义, 将会使用 <code>es_host</code> 以及 <code>es_port</code> 拼接成一个 URL.</p>
<h5 id="use-kibana-dashboard-string-no-default"><a class="header-anchor" href="#use-kibana-dashboard-string-no-default">¶</a><code>use_kibana_dashboard</code> (string, no default)</h5>
<p>Kibana3 面板的名称. 不像 <code>generate_kibana_link</code> 那样从一个模板生成一个面板, ElastAlert 可以复用一个已存在的面板. 它会在面板上根据<code>匹配</code> 的时间将该时间范围设置到面板, 将其上传为一个临时面板, 并添加一个 filter 到 <code>告警</code> 的 <code>query_key</code> 字段上（如果有的话）, 然后将 url 放到 <code>告警</code>里面.</p>
<h5 id="use-kibana4-dashboard-string-no-default"><a class="header-anchor" href="#use-kibana4-dashboard-string-no-default">¶</a><code>use_kibana4_dashboard</code> (string, no default)</h5>
<p>一个 Kibana4 面板的链接. 例如, “<a href="https://kibana.example.com/#/dashboard/My-Dashboard%E2%80%9D" target="_blank" rel="noopener">https://kibana.example.com/#/dashboard/My-Dashboard”</a>. This will set the time setting on the dashboard from the match time minus the timeframe, to 10 minutes after the match time. Note that this does not support filtering by <code>query_key</code> like Kibana 3. This value can use $VAR and ${VAR} references to expand environment variables.</p>
<h5 id="kibana4-start-timedelta-time-default-10-min"><a class="header-anchor" href="#kibana4-start-timedelta-time-default-10-min">¶</a><code>kibana4_start_timedelta</code> (time, default: 10 min)</h5>
<h5 id="kibana4-end-timedelta-time-default-10-min"><a class="header-anchor" href="#kibana4-end-timedelta-time-default-10-min">¶</a><code>kibana4_end_timedelta</code> (time, default: 10 min)</h5>
<h5 id="use-local-time-boolean-default-True"><a class="header-anchor" href="#use-local-time-boolean-default-True">¶</a><code>use_local_time</code> (boolean, default True)</h5>
<h5 id="match-enhancements-list-of-strs-no-default"><a class="header-anchor" href="#match-enhancements-list-of-strs-no-default">¶</a><code>match_enhancements</code> (list of strs, no default)</h5>
<h5 id="top-count-keys-list-of-strings"><a class="header-anchor" href="#top-count-keys-list-of-strings">¶</a><code>top_count_keys</code> (list of strings)</h5>
<p>一个包含多个字段的集合. ElastAlert 会在这些字段上使用 term query 查询 X 个最常见的值, X 默认值是 5, 或者 <code>top_count_number</code>（如果该选项被存在）. For example, if <code>num_events</code> is 100, and <code>top_count_keys</code> is <code>- &quot;username&quot;</code>, the alert will say how many of the 100 events have each username, for the top 5 usernames. When this is computed, the time range used is from <code>timeframe</code> before the most recent event to 10 minutes past the most recent event. Because ElastAlert uses an aggregation query to compute this, it will attempt to use the field name plus “.raw” to count unanalyzed terms. To turn this off, set <code>raw_count_keys</code> to false.</p>
<h5 id="top-count-number-int-default-5"><a class="header-anchor" href="#top-count-number-int-default-5">¶</a><code>top_count_number</code> (int, default 5)</h5>
<p>如果 <code>top_count_keys</code> 设置, 该选项为 term query 中每个 terms 的数量.</p>
<h5 id="raw-count-keys-boolean-default-True"><a class="header-anchor" href="#raw-count-keys-boolean-default-True">¶</a><code>raw_count_keys</code> (boolean, default True)</h5>
<p>如果设置为 true, 所有在 <code>top_count_keys</code> 中定义的字段都会拼接一个 <code>.raw</code> 后缀.（一个 keyword 类型的子字段, 高版本的 ES 后缀为 <code>.keyword</code>）</p>
<h5 id="scan-entire-timeframe-bool-default-False"><a class="header-anchor" href="#scan-entire-timeframe-bool-default-False">¶</a><code>scan_entire_timeframe</code> (bool, default False)</h5>
<h5 id="import-string-no-default-IGNORED-IF-use-count-query-or-use-terms-query-is-true"><a class="header-anchor" href="#import-string-no-default-IGNORED-IF-use-count-query-or-use-terms-query-is-true">¶</a><code>import</code> (string no default) IGNORED IF <code>use_count_query</code> or <code>use_terms_query</code> is true</h5>
<p>将所有设置导入到当前 yaml 文件中. 这允许通用配置选项被共享. 注意导入的文件如果不包含完整的<code>规则</code>配置就应该以<code>.yml</code>或者<code>.yaml</code>为后缀, 这样 ElastAlert 才不会加载它们并报错. 在被导入的文件中的 Filters 将会在当前<code>规则</code>中被合并成一个 <code>Any Filters</code> . 在一个<code>规则</code>配置文件中只能有一个 <code>import</code>, 不过被 import 的文件又可以 import 其它的文件. 导入的文件名称可以是绝对路径和相对于<code>规则路径</code>.</p>
<h5 id="timestamp-type-string-default-iso"><a class="header-anchor" href="#timestamp-type-string-default-iso">¶</a><code>timestamp_type</code> (string, default iso)</h5>
<h5 id="timestamp-format-string-default-“-Y-m-dT-H-M-SZ”"><a class="header-anchor" href="#timestamp-format-string-default-“-Y-m-dT-H-M-SZ”">¶</a><code>timestamp_format</code> (string, default “%Y-%m-%dT%H:%M:%SZ”)</h5>
<h5 id="timestamp-format-expr-string-no-default"><a class="header-anchor" href="#timestamp-format-expr-string-no-default">¶</a><code>timestamp_format_expr</code> (string, no default )</h5>
<h5 id="source-enabled-boolean-default-True"><a class="header-anchor" href="#source-enabled-boolean-default-True">¶</a><code>_source_enabled</code> (boolean, default True)</h5>
<h5 id="alert-text-args-array-of-strs"><a class="header-anchor" href="#alert-text-args-array-of-strs">¶</a><code>alert_text_args</code> (array of strs)</h5>
<h5 id="alert-text-kw-object"><a class="header-anchor" href="#alert-text-kw-object">¶</a><code>alert_text_kw</code> (object)</h5>
<h5 id="alert-missing-value-string-default-“-MISSING-VALUE-”"><a class="header-anchor" href="#alert-missing-value-string-default-“-MISSING-VALUE-”">¶</a><code>alert_missing_value</code> (string, default “<missing value>”)</missing></h5>
<h5 id="is-enabled-boolean-default-True"><a class="header-anchor" href="#is-enabled-boolean-default-True">¶</a><code>is_enabled</code> (boolean, default True)</h5>
<h5 id="search-extra-index-boolean-default-False"><a class="header-anchor" href="#search-extra-index-boolean-default-False">¶</a><code>search_extra_index</code> (boolean, default False)</h5>
<p>If this is true, ElastAlert will add an extra index on the early side onto each search. For example, if it’s querying completely within 2018-06-28, it will actually use 2018-06-27,2018-06-28. This can be useful if your timestamp_field is not what’s being used to generate the index names. If that’s the case, sometimes a query would not have been using the right index.</p>
<table>
<thead>
<tr>
<th>RULE TYPE</th>
<th>Any</th>
<th>Blacklist</th>
<th>Whitelist</th>
<th>Change</th>
<th>Frequency</th>
<th>Spike</th>
<th>Flatline</th>
<th>New_term</th>
<th>Cardinality</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>compare_key</code> (list of strs, no default)</td>
<td></td>
<td>Req</td>
<td>Req</td>
<td>Req</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>blacklist</code> (list of strs, no default)</td>
<td></td>
<td>Req</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>whitelist</code> (list of strs, no default)</td>
<td></td>
<td></td>
<td>Req</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>ignore_null</code> (boolean, no default)</td>
<td></td>
<td></td>
<td>Req</td>
<td>Req</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>query_key</code> (string, no default)</td>
<td>Opt</td>
<td></td>
<td></td>
<td>Req</td>
<td>Opt</td>
<td>Opt</td>
<td>Opt</td>
<td>Req</td>
<td>Opt</td>
</tr>
<tr>
<td><code>aggregation_key</code> (string, no default)</td>
<td>Opt</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>summary_table_fields</code> (list, no default)</td>
<td>Opt</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>timeframe</code> (time, no default)</td>
<td></td>
<td></td>
<td></td>
<td>Opt</td>
<td>Req</td>
<td>Req</td>
<td>Req</td>
<td></td>
<td>Req</td>
</tr>
<tr>
<td><code>num_events</code> (int, no default)</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>Req</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>attach_related</code> (boolean, no default)</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>Opt</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>use_count_query</code> (boolean, no default)<code>doc_type</code> (string, no default)</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>Opt</td>
<td>Opt</td>
<td>Opt</td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>use_terms_query</code> (boolean, no default)<br><code>doc_type</code> (string, no default)<br><code>query_key</code> (string, no default)<br><code>terms_size</code> (int, default 50)</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>Opt</td>
<td>Opt</td>
<td></td>
<td>Opt</td>
<td></td>
</tr>
<tr>
<td><code>spike_height</code> (int, no default)</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>Req</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>spike_type</code> ([up|down|both], no default)</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>Req</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>alert_on_new_data</code> (boolean, default False)</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>Opt</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>threshold_ref</code> (int, no default)</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>Opt</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>threshold_cur</code> (int, no default)</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>Opt</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>threshold</code> (int, no default)</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>Req</td>
<td></td>
<td></td>
</tr>
<tr>
<td><code>fields</code> (string or list, no default)</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>Req</td>
<td></td>
</tr>
<tr>
<td><code>terms_window_size</code> (time, default 30 days)</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>Opt</td>
<td></td>
</tr>
<tr>
<td><code>window_step_size</code> (time, default 1 day)</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>Opt</td>
<td></td>
</tr>
<tr>
<td><code>alert_on_missing_fields</code> (boolean, default False)</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>Opt</td>
<td></td>
</tr>
<tr>
<td><code>cardinality_field</code> (string, no default)</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>Req</td>
</tr>
<tr>
<td><code>max_cardinality</code> (boolean, no default)</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>Opt</td>
</tr>
<tr>
<td><code>min_cardinality</code> (boolean, no default)</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>Opt</td>
</tr>
</tbody>
</table>

            </div>
            <hr />

            
            <style>
    #reward {
        margin: 40px 0;
        text-align: center;
    }

    #reward .reward-link {
        font-size: 1.88rem;
    }

    #reward .btn-floating:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    #rewardModal {
        width: 320px;
        height: 350px;
    }

    #rewardModal .reward-title {
        margin: 15px auto;
        padding-bottom: 5px;
    }

    #rewardModal .modal-content {
        padding: 10px;
    }

    #rewardModal .close {
        position: absolute;
        right: 15px;
        top: 15px;
        color: rgba(0, 0, 0, 0.5);
        font-size: 1.3rem;
        line-height: 20px;
        cursor: pointer;
    }

    #rewardModal .close:hover {
        color: #ef5350;
        transform: scale(1.3);
        -moz-transform:scale(1.3);
        -webkit-transform:scale(1.3);
        -o-transform:scale(1.3);
    }

    #rewardModal .reward-tabs {
        margin: 0 auto;
        width: 210px;
    }

    .reward-tabs .tabs {
        height: 38px;
        margin: 10px auto;
        padding-left: 0;
    }

    .reward-content ul {
        padding-left: 0 !important;
    }

    .reward-tabs .tabs .tab {
        height: 38px;
        line-height: 38px;
    }

    .reward-tabs .tab a {
        color: #fff;
        background-color: #ccc;
    }

    .reward-tabs .tab a:hover {
        background-color: #ccc;
        color: #fff;
    }

    .reward-tabs .wechat-tab .active {
        color: #fff !important;
        background-color: #22AB38 !important;
    }

    .reward-tabs .alipay-tab .active {
        color: #fff !important;
        background-color: #019FE8 !important;
    }

    .reward-tabs .reward-img {
        width: 210px;
        height: 210px;
    }
</style>

<div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-large waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fa fa-close"></i></a>
            <h4 class="reward-title">写作不易，客官能否打赏一杯奶茶？</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/medias/reward/alipay.jpg" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/medias/reward/wechat.jpg" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>
            

            <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">

<div id="article-share">
    
    <div class="social-share" data-disabled="qzone" data-wechat-qrcode-helper="<p>微信里点“发现”->“扫一扫”二维码便可查看分享。</p>"></div>
    
</div>

<script src="/libs/share/js/social-share.min.js"></script>

            

    <div class="reprint" id="reprint-statement">
        <p class="reprint-tip">
            <i class="fa fa-exclamation-triangle"></i>&nbsp;&nbsp;
            <span>转载规则</span>
        </p>
        
            <div class="center-align">
                <a rel="license" href="https://creativecommons.org/licenses/by/4.0/deed.zh">
                    <img alt=""
                         style="border-width:0"
                         src="https://i.creativecommons.org/l/by/4.0/88x31.png"/>
                </a>
            </div>
            <br/>
            <span xmlns:dct="http://purl.org/dc/terms/" href="http://purl.org/dc/dcmitype/Text"
                  property="dct:title" rel="dct:type">
                    《02_规则类型和配置选项》
                </span> 由
            <a xmlns:cc="http://creativecommons.org/ns#" href="/2020/12/22/elastalert/02-gui-ze-lei-xing-he-pei-zhi-xuan-xiang/" property="cc:attributionName"
               rel="cc:attributionURL">
                阿钟
            </a> 采用
            <a rel="license" href="https://creativecommons.org/licenses/by/4.0/deed.zh">
                知识共享署名 4.0 国际许可协议
            </a>进行许可。
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>


        </div>
    </div>

    
    <link rel="stylesheet" href="/libs/gitalk/gitalk.css">
<link rel="stylesheet" href="/css/my-gitalk.css">

<div class="card gitalk-card" data-aos="fade-up">
    <div id="gitalk-container" class="card-content"></div>
</div>

<script src="/libs/gitalk/gitalk.min.js"></script>
<script>
    let gitalk = new Gitalk({
        clientID: '466e387c08bce10f3f28',
        clientSecret: '5b2bf16f8a42bd72eef32e50187c7f2ccb105a1d',
        repo: 'azhong.github.io',
        owner: 'JohnZhongg',
        admin: "JohnZhongg",
        id: '2020/12/22/elastalert/02-gui-ze-lei-xing-he-pei-zhi-xuan-xiang/',
        distractionFreeMode: false  // Facebook-like distraction free mode
    });

    gitalk.render('gitalk-container');
</script>
    

    

    

    

    
    <style>
    .valine-card {
        margin: 1.5rem auto;
    }

    .valine-card .card-content {
        padding: 20px 20px 5px 20px;
    }

    #vcomments input[type=text],
    #vcomments input[type=email],
    #vcomments input[type=url],
    #vcomments textarea {
        box-sizing: border-box;
    }

    #vcomments p {
        margin: 2px 2px 10px;
        font-size: 1.05rem;
        line-height: 1.78rem;
    }

    #vcomments blockquote p {
        text-indent: 0.2rem;
    }

    #vcomments a {
        padding: 0 2px;
        color: #42b983;
        font-weight: 500;
        text-decoration: underline;
    }

    #vcomments img {
        max-width: 100%;
        height: auto;
        cursor: pointer;
    }

    #vcomments ol li {
        list-style-type: decimal;
    }

    #vcomments ol,
    ul {
        display: block;
        padding-left: 2em;
        word-spacing: 0.05rem;
    }

    #vcomments ul li,
    ol li {
        display: list-item;
        line-height: 1.8rem;
        font-size: 1rem;
    }

    #vcomments ul li {
        list-style-type: disc;
    }

    #vcomments ul ul li {
        list-style-type: circle;
    }

    #vcomments table, th, td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    #vcomments table, th, td {
        border: 0;
    }

    table tr:nth-child(2n), thead {
        background-color: #fafafa;
    }

    #vcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #vcomments table td {
        min-width: 80px;
    }

    #vcomments h1 {
        font-size: 1.85rem;
        font-weight: bold;
        line-height: 2.2rem;
    }

    #vcomments h2 {
        font-size: 1.65rem;
        font-weight: bold;
        line-height: 1.9rem;
    }

    #vcomments h3 {
        font-size: 1.45rem;
        font-weight: bold;
        line-height: 1.7rem;
    }

    #vcomments h4 {
        font-size: 1.25rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    #vcomments h5 {
        font-size: 1.1rem;
        font-weight: bold;
        line-height: 1.4rem;
    }

    #vcomments h6 {
        font-size: 1rem;
        line-height: 1.3rem;
    }

    #vcomments p {
        font-size: 1rem;
        line-height: 1.5rem;
    }

    #vcomments hr {
        margin: 12px 0;
        border: 0;
        border-top: 1px solid #ccc;
    }

    #vcomments blockquote {
        margin: 15px 0;
        border-left: 5px solid #42b983;
        padding: 1rem 0.8rem 0.3rem 0.8rem;
        color: #666;
        background-color: rgba(66, 185, 131, .1);
    }

    #vcomments pre {
        font-family: monospace, monospace;
        padding: 1.2em;
        margin: .5em 0;
        background: #272822;
        overflow: auto;
        border-radius: 0.3em;
        tab-size: 4;
    }

    #vcomments code {
        font-family: monospace, monospace;
        padding: 1px 3px;
        font-size: 0.92rem;
        color: #e96900;
        background-color: #f8f8f8;
        border-radius: 2px;
    }

    #vcomments pre code {
        font-family: monospace, monospace;
        padding: 0;
        color: #e8eaf6;
        background-color: #272822;
    }

    #vcomments pre[class*="language-"] {
        padding: 1.2em;
        margin: .5em 0;
    }

    #vcomments code[class*="language-"],
    pre[class*="language-"] {
        color: #e8eaf6;
    }

    #vcomments [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }

    #vcomments b,
    strong {
        font-weight: bold;
    }

    #vcomments dfn {
        font-style: italic;
    }

    #vcomments small {
        font-size: 85%;
    }

    #vcomments cite {
        font-style: normal;
    }

    #vcomments mark {
        background-color: #fcf8e3;
        padding: .2em;
    }

    #vcomments table, th, td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    table tr:nth-child(2n), thead {
        background-color: #fafafa;
    }

    #vcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #vcomments table td {
        min-width: 80px;
    }

    #vcomments [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }
</style>

<div class="card valine-card" data-aos="fade-up">
    <div id="vcomments" class="card-content"></div>
</div>

<script src="/libs/valine/av-min.js"></script>
<script src="/libs/valine/Valine.min.js"></script>
<!-- <script src="//unpkg.com/valine@latest/dist/Valine.min.js"></script> -->

<script>
    new Valine({
        el: '#vcomments',
        appId: '',
        appKey: '',
        notify: 'false' === 'true',
        verify: 'false' === 'true',
        visitor: 'false' === 'true',
        avatar: 'wavatar',
        pageSize: '10',
        lang: 'zh-cn',
        placeholder: '如果你没有GitHub账号，还可以在这里评论啦！'
    });
</script>

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fa fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/2020/12/23/elastalert/elastalert-ju-he-gao-jing/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/1.jpg" class="responsive-img" alt="elastalert聚合告警">
                        
                        <span class="card-title">elastalert聚合告警</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            源码修改增加自定义聚合功能
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="fa fa-clock-o fa-fw icon-date"></i>2020-12-23
                        </span>
                        <span class="publish-author">
                            
                            <i class="fa fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/elastalert/" class="post-category" target="_blank">
                                    elastalert
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/ELK告警/" target="_blank">
                        <span class="chip bg-color">ELK告警</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fa fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2020/12/22/elastalert/01-shou-ci-yun-xing-elastalert/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/0.jpg" class="responsive-img" alt="01_首次运行elastalert">
                        
                        <span class="card-title">01_首次运行elastalert</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            ELK告警
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="fa fa-clock-o fa-fw icon-date"></i>2020-12-22
                            </span>
                        <span class="publish-author">
                            
                            <i class="fa fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/elastalert/" class="post-category" target="_blank">
                                    elastalert
                                </a>
                            
                            <a href="/categories/elastalert/ES学习/" class="post-category" target="_blank">
                                    ES学习
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/ES学习/" target="_blank">
                        <span class="chip bg-color">ES学习</span>
                    </a>
                    
                    <a href="/tags/ELK告警/" target="_blank">
                        <span class="chip bg-color">ELK告警</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>
</div>


    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget">
            <div class="toc-title"><i class="fa fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fa fa-list"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            // headingsOffset: -205,
            headingSelector: 'h1, h2, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h1, h2, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).slideUp(500);
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).slideDown(500);
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>
    

</main>


<script src="https://cdn.bootcss.com/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script>
    MathJax.Hub.Config({
        tex2jax: {inlineMath: [['$', '$'], ['\(', '\)']]}
    });
</script>

<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>
<!-- 代码语言 -->
<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>
<!-- 代码块复制 -->
<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>
<script type="text/javascript" src="/libs/codeBlock/clipboard.min.js"></script>
<!-- 代码块收缩 -->
<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script> 
<!-- 代码块折行 -->
<style type="text/css">code[class*="language-"], pre[class*="language-"] { white-space: pre !important; }</style>


    <footer class="page-footer bg-color">
    <div class="container row center-align">
        <div class="col s12 m8 l8 copy-right">
            &copy; 2020- Azhong. 版权所有

            
            &nbsp;<i class="fa fa-area-chart"></i>&nbsp;站点总字数:&nbsp;
            <span class="white-color">636.4k</span>
            

            <br>
            <span id="sitetime"></span>

            
            
            <br>
            
            <span id="busuanzi_container_site_pv" style='display:none'>
                <i class="fa fa-heart-o"></i>
                本站总访问量 <span id="busuanzi_value_site_pv" class="white-color"></span>
            </span>
            
            
            <span id="busuanzi_container_site_uv" style='display:none'>
                人次,&nbsp;访客数 <span id="busuanzi_value_site_uv" class="white-color"></span> 人.
            </span>
            
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/JohnZhongg" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fa fa-github"></i>
    </a>



    <a href="mailto:707845008@qq.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fa fa-envelope-open"></i>
    </a>



    <a href="https://zhihu.com/people/change-94-17" class="tooltipped" target="_blank" data-tooltip="访问我的知乎" data-position="top" data-delay="50">
        <i class="fa fa-inverse">知</i>
    </a>



    <a href="http://wpa.qq.com/msgrd?v=3&uin=707845008&site=qq&menu=yes" class="tooltipped" target="_blank" data-tooltip="访问我的知乎" data-position="top" data-delay="50">
        <i class="fa fa-qq"></i>
    </a>


<!-- 


    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fa fa-rss"></i>
    </a>
 --></div>
    </div>
</footer>

<div class="progress-bar"></div>

<!-- 不蒜子计数初始值纠正 -->
<script>
    $(document).ready(function () {

        var int = setInterval(fixCount, 50);
        var pvcountOffset = 0;
        var uvcountOffset = 0;

        function fixCount() {
            if (document.getElementById("busuanzi_container_site_pv").style.display != "none") {
                $("#busuanzi_value_site_pv").html(parseInt($("#busuanzi_value_site_pv").html()) + pvcountOffset);
                clearInterval(int);
            }
            if ($("#busuanzi_container_site_pv").css("display") != "none") {
                $("#busuanzi_value_site_uv").html(parseInt($("#busuanzi_value_site_uv").html()) + uvcountOffset); // 加上初始数据 
                clearInterval(int);
            }
        }
    });
</script>

<script language=javascript>
    function siteTime() {
        window.setTimeout("siteTime()", 1000);
        var seconds = 1000;
        var minutes = seconds * 60;
        var hours = minutes * 60;
        var days = hours * 24;
        var years = days * 365;
        var today = new Date();
        var todayYear = today.getFullYear();
        var todayMonth = today.getMonth() + 1;
        var todayDate = today.getDate();
        var todayHour = today.getHours();
        var todayMinute = today.getMinutes();
        var todaySecond = today.getSeconds();
        /* Date.UTC() -- 返回date对象距世界标准时间(UTC)1970年1月1日午夜之间的毫秒数(时间戳)
        year - 作为date对象的年份，为4位年份值
        month - 0-11之间的整数，做为date对象的月份
        day - 1-31之间的整数，做为date对象的天数
        hours - 0(午夜24点)-23之间的整数，做为date对象的小时数
        minutes - 0-59之间的整数，做为date对象的分钟数
        seconds - 0-59之间的整数，做为date对象的秒数
        microseconds - 0-999之间的整数，做为date对象的毫秒数 */
        var t1 = Date.UTC(2020, 12, 20, 00, 00, 00); //北京时间2018-2-13 00:00:00
        var t2 = Date.UTC(todayYear, todayMonth, todayDate, todayHour, todayMinute, todaySecond);
        var diff = t2 - t1;
        var diffYears = Math.floor(diff / years);
        var diffDays = Math.floor((diff / days) - diffYears * 365);
        var diffHours = Math.floor((diff - (diffYears * 365 + diffDays) * days) / hours);
        var diffMinutes = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours) / minutes);
        var diffSeconds = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours - diffMinutes * minutes) / seconds);
        document.getElementById("sitetime").innerHTML = "本站已运行 " + diffYears + " 年 " + diffDays + " 天 " + diffHours + " 小时 " + diffMinutes + " 分钟 " + diffSeconds + " 秒";
    }/*因为建站时间还没有一年，就将之注释掉了。需要的可以取消*/
    siteTime();
</script>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fa fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script src="/js/search.js"></script>
<script type="text/javascript">
$(function () {
    searchFunc("/" + "search.xml", 'searchInput', 'searchResult');
});
</script>
    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fa fa-angle-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    <script type="text/javascript"> var OriginTitile = document.title, st; document.addEventListener("visibilitychange", function () { document.hidden ? (document.title = "Σ(っ °Д °;)っ喔哟，崩溃啦！", clearTimeout(st)) : (document.title = "φ(゜▽゜*)♪咦，又好了！", st = setTimeout(function () { document.title = OriginTitile }, 3e3)) })
    </script>

    <!-- Global site tag (gtag.js) - Google Analytics -->

<script async src="https://www.googletagmanager.com/gtag/js?id="></script>
<script>
    window.dataLayer = window.dataLayer || [];
    function gtag() {
        dataLayer.push(arguments);
    }

    gtag('js', new Date());
    gtag('config', '');
</script>



    
    <script src="/libs/others/clicklove.js"></script>
    

    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    <!-- 雪花特效 -->
    

</body>

</html>